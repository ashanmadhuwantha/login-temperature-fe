{"ast":null,"code":"import store from \"../redux/store/index\";\nimport axios from \"axios\";\nimport { authActions } from \"../redux/actions/authActions\";\nimport LocalStorageService from \"../services/storage/localStorageService\";\nconst API_URL = process.env.REACT_APP_API_URL;\nconsole.log(process.env.REACT_APP_API_URL);\nconst localStorageService = LocalStorageService.getService(); //Add a response interceptor\n\nexport function responseInterceptor() {\n  axios.interceptors.response.use(response => {\n    return response;\n  }, function (error) {\n    const originalRequest = error.config;\n\n    if (error.response.status === 401 && originalRequest.url === API_URL + \"auth/refresh-token\") {\n      store.dispatch(authActions.logout());\n      localStorage.removeItem(\"access_token\");\n      localStorageService.clearToken();\n      return Promise.reject(error);\n    }\n\n    if (error.response.status === 400 && originalRequest.url === API_URL + \"auth/refresh-token\") {\n      localStorage.removeItem(\"access_token\");\n      localStorageService.clearToken();\n      return Promise.reject(error);\n    }\n\n    if (error.response.status === 500 && originalRequest.url === API_URL + \"auth/refresh-token\") {\n      localStorage.removeItem(\"access_token\");\n      localStorageService.clearToken();\n      return Promise.reject(error);\n    }\n\n    if (error.response.status === 401 && originalRequest.url === API_URL + \"auth/login\") {\n      localStorage.removeItem(\"access_token\");\n      store.dispatch(authActions.logout());\n      return Promise.reject(error);\n    }\n\n    if (error.response.status === 401 && !originalRequest._retry) {\n      originalRequest._retry = true;\n      const refresh_token = localStorageService.getRefreshToken();\n      return axios.post(API_URL + \"auth/refresh-token\", {\n        refresh_token: refresh_token\n      }).then(res => {\n        if (res.status === 200) {\n          localStorageService.setToken(res.data);\n          axios.defaults.headers.common[\"Authorization\"] = \"Bearer \" + localStorageService.getAccessToken();\n          return axios(originalRequest);\n        }\n      });\n    }\n\n    return Promise.reject(error);\n  });\n}","map":{"version":3,"sources":["/Users/ashanmadhuwantha/Documents/Github/login-temperature-fe/src/services/responseInterceptor.js"],"names":["store","axios","authActions","LocalStorageService","API_URL","process","env","REACT_APP_API_URL","console","log","localStorageService","getService","responseInterceptor","interceptors","response","use","error","originalRequest","config","status","url","dispatch","logout","localStorage","removeItem","clearToken","Promise","reject","_retry","refresh_token","getRefreshToken","post","then","res","setToken","data","defaults","headers","common","getAccessToken"],"mappings":"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","sourcesContent":["import store from \"../redux/store/index\";\r\nimport axios from \"axios\";\r\n\r\nimport { authActions } from \"../redux/actions/authActions\";\r\n\r\nimport LocalStorageService from \"../services/storage/localStorageService\";\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL;\r\nconsole.log(process.env.REACT_APP_API_URL)\r\n\r\nconst localStorageService = LocalStorageService.getService();\r\n\r\n//Add a response interceptor\r\n\r\nexport function responseInterceptor() {\r\n  axios.interceptors.response.use(\r\n    (response) => {\r\n      return response;\r\n    },\r\n\r\n    function (error) {\r\n      const originalRequest = error.config;\r\n\r\n      if (\r\n        error.response.status === 401 &&\r\n        originalRequest.url === API_URL + `auth/refresh-token`\r\n      ) {\r\n        store.dispatch(authActions.logout());\r\n        localStorage.removeItem(\"access_token\");\r\n        localStorageService.clearToken();\r\n        return Promise.reject(error);\r\n      }\r\n      if (\r\n        error.response.status === 400 &&\r\n        originalRequest.url === API_URL + `auth/refresh-token`\r\n      ) {\r\n        localStorage.removeItem(\"access_token\");\r\n        localStorageService.clearToken();\r\n        return Promise.reject(error);\r\n      }\r\n      if (\r\n        error.response.status === 500 &&\r\n        originalRequest.url === API_URL + `auth/refresh-token`\r\n      ) {\r\n        localStorage.removeItem(\"access_token\");\r\n        localStorageService.clearToken();\r\n        return Promise.reject(error);\r\n      }\r\n      if (\r\n        error.response.status === 401 &&\r\n        originalRequest.url === API_URL + `auth/login`\r\n      ) {\r\n        localStorage.removeItem(\"access_token\");\r\n        store.dispatch(authActions.logout());\r\n        return Promise.reject(error);\r\n      }\r\n\r\n      if (error.response.status === 401 && !originalRequest._retry) {\r\n        originalRequest._retry = true;\r\n\r\n        const refresh_token = localStorageService.getRefreshToken();\r\n\r\n        return axios\r\n          .post(API_URL + `auth/refresh-token`, {\r\n            refresh_token: refresh_token,\r\n          })\r\n          .then((res) => {\r\n            if (res.status === 200) {\r\n              localStorageService.setToken(res.data);\r\n              axios.defaults.headers.common[\"Authorization\"] =\r\n                \"Bearer \" + localStorageService.getAccessToken();\r\n              return axios(originalRequest);\r\n            }\r\n          });\r\n      }\r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}